{% extends "home/base.html" %}
{% load staticfiles %}
{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/nv.d3.min.css' %}" type="text/css" />
<style>
.nv-x text{
font-size: 10px;
}
</style>
{% endblock %}
{% block content %}

<h2>GPCRs as drug targets:</h2>

<div id="pie_classes"></div>
<div id="pie_families"></div>
<div id="pie_targets"></div>
<div id="pie_types"></div>
<div id="pie_disease"></div>
<br>
<br>
 <div id="unique" class="chart_container" style="display: none;">
        <div id="unique_year"><svg id="unique_cryst" style="width:1050;height:500px;"></svg></div>
<br>
<br>
<br>
<br>
<br>
{% endblock %}
{% block addon_js %}
<!-- http://d3pie.org/#generator-result -->
<script src="{% static 'home/js/d3.min.js' %}"></script>
<script src="{% static 'home/js/d3pie.js' %}"></script>
<script src="{% static 'home/js/nv.d3.min.js' %}"></script>

<script>
 // function mergeSVG(div) {
 //     var SVG = $('#'+div).find('svg')[0];
 //     h = parseInt($(SVG).attr('height'));
 //     w = parseInt($(SVG).attr('width'));
 //     var legend = $('#legend').find('svg')[0];
 //     h2 = parseInt($(legend).attr('height'));
 //     w2 = parseInt($(legend).attr('width'));
 //     leg_w = (w-w2)/2
 //     SVG.setAttribute('height', (h + h2));
 //     if (w2 > w) {
 //         SVG.setAttribute('width', (w2));
 //         leg_w = 0 
 //         svg_w = Math.abs(w-w2)/2
 //     } else {
 //         leg_w = Math.abs(w-w2)/2 
 //         svg_w = 0
 //     };
 //     for (i = 0; i < legend.children.length; i++) {
 //         legend.children[i].setAttribute('transform', 'translate ('+leg_w.toString()+' ' + h.toString()+')');
 //         $(SVG).append(legend.children[i]);
 //     };
 // };

 window.onload = function () {
    //Unique crystals/year
    nv.addGraph(function () {
        var datum = {{drugs_over_time|safe}};
        var chart = nv.models.multiBarChart()
            .reduceXTicks(false)
            .stacked(false)
            .margin({ top: 30, right: 60, bottom: 20, left: 60 })
            .color(d3.scale.category20().range());
        chart.yAxis
            .tickFormat(d3.format(',f'))
            ._ticks(nv.utils.calcTicksY(400 / 36, datum));
        // chart.xAxis
        //     .rotateLabels(-45)

        var yAxis2 = nv.models.axis()
            .scale(chart.yScale())
            .showMaxMin(false)
            .tickFormat(d3.format(',f'))
            ._ticks(nv.utils.calcTicksY(400 / 36, datum))
            .tickPadding(0)
            .orient("right");

        d3.select('#unique_year svg')
            .datum(datum)
            .transition().duration(500)
            .call(chart);
        d3.select('#unique_year svg').selectAll('g.nv-wrap.nv-multiBarWithLegend').append("g")
            .attr("class", "nv-y nv-axis")
            .attr("transform", "translate(940, 0)")
            .call(yAxis2);
    });

    $(".chart_type").click(function () {
        Clear_all()
        // $(this).css("fill", '#000000');
        point = $('#' + $(this).attr('id')).find('svg')
        $(point).css("visibility", 'hidden');
        $('#'+$(this).attr('id') + '.chart_container').css("display", '');
    });
    // $(".Class_phylo").click(function () {
    //     Clear_phylo()
    //     var id = $(this).attr('id');
    //     if ($('#' + id + '.container').find("svg").length == 0) {
    //         console.log('Drawing...');
    //         // draw(id.substr(id.length - 1));
    //     };

    //     $(this).css("fill", '#000000');
    //     //point = $('#' + $(this).attr('id')).find('svg')
    //     //$(point).css("visibility", 'hidden');
    //     $('#' + $(this).attr('id') + '.container').css("display", '');
    // });

    function Clear_all() {
        $('#charts').find(".chart_type").each(function (index) {
            $(this).css("fill", '');
        });
        $('#charts').find(".chart_container").each(function (index) {
            $(this).css("display", 'none');
        });
    };
    function Clear_phylo(){
        $('#phylos').find(".Class_phylo").each(function (index) {
            $(this).css("fill", '');
            $('#'+$(this).attr('id')+".container").css("display", 'none');
        });
    };
    // function draw(number) {
    //     $.ajax({
    //         'url': '/structure/showtrees',
    //         'data': {
    //             number: number
    //         },
    //         'type': 'get',
    //         ยง {
    //             $("#phylos_div").html(data);
    //         }
    //     });
    // };
    
 
    $(document).ready(function () {
        $('#unique.chart_type').css("fill", '#000000');
        $('#unique.chart_container').css("display", '');
        // draw('1');

    });
};
</script>

<script>
var pie = new d3pie("pie_types", {
  "header": {
    "title": {
      "text": "Drugtypes",
      "fontSize": 32,
      "font": "open sans"
    },
    "subtitle": {
      "text": " ",
      "color": "#999999",
      "fontSize": 12,
      "font": "open sans"
    },
    "titleSubtitlePadding": 25
  },
  "footer": {
    "text": "Approved and distinct drugs",
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "center"
  },
  "size": {
    "canvasHeight": 600,
    "canvasWidth": 1100,
    "pieInnerRadius": "50%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "sortOrder": "value-asc",
    "smallSegmentGrouping": {
      "enabled": false,
      "value": 1
    },
    "content": {{drugtypes|safe}}
  },
  "labels": {
    "outer": {
      "pieDistance": 21
    },
    "inner": {
      "hideWhenLessThanPercentage": 3
    },
    "mainLabel": {
      "fontSize": 12
    },
    "percentage": {
      "color": "#ffffff",
      "fontSize": 12
    },
    "value": {
      "color": "#adadad",
      "fontSize": 12
    },
    "lines": {
      "enabled": true,
      "style": "straight"
    },
    "truncation": {
      "enabled": true
    }
  },
  "tooltips": {
    "enabled": true,
    "type": "placeholder",
    "string": "{label}: {value}, {percentage}%",
    "styles": {
      "fadeInSpeed": 0,
      "backgroundOpacity": 0.71,
      "borderRadius": 10,
      "fontSize": 15
    }
  },
  "effects": {
    "load": {
      "speed": 800
    },
    "pullOutSegmentOnClick": {
      "effect": "linear",
      "speed": 400,
      "size": 14
    }
  },
  "misc": {
    "gradient": {
      "enabled": true,
      "percentage": 65
    }
  }
});

var pie = new d3pie("pie_classes", {
  "header": {
    "title": {
      "text": "Class targets",
      "fontSize": 32,
      "font": "open sans"
    },
    "subtitle": {
      "text": " ",
      "color": "#999999",
      "fontSize": 12,
      "font": "open sans"
    },
    "titleSubtitlePadding": 25
  },
  "footer": {
    "text": "Approved and distinct drugs",
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "center"
  },
  "size": {
    "canvasHeight": 600,
    "canvasWidth": 1100,
    "pieInnerRadius": "50%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "sortOrder": "value-desc",
    "smallSegmentGrouping": {
      "enabled": false,
      "value": 1
    },
    "content": {{drugclasses|safe}}
  },
  "labels": {
    "outer": {
      "pieDistance": 21
    },
    "inner": {
      "hideWhenLessThanPercentage": 3
    },
    "mainLabel": {
      "fontSize": 12
    },
    "percentage": {
      "color": "#ffffff",
      "fontSize": 12
    },
    "value": {
      "color": "#adadad",
      "fontSize": 12
    },
    "lines": {
      "enabled": true,
      "style": "straight"
    },
    "truncation": {
      "enabled": true
    }
  },
  "tooltips": {
    "enabled": true,
    "type": "placeholder",
    "string": "{label}: {value}, {percentage}%",
    "styles": {
      "fadeInSpeed": 0,
      "backgroundOpacity": 0.71,
      "borderRadius": 10,
      "fontSize": 15
    }
  },
  "effects": {
    "load": {
      "speed": 800
    },
    "pullOutSegmentOnClick": {
      "effect": "linear",
      "speed": 400,
      "size": 14
    }
  },
  "misc": {
    "gradient": {
      "enabled": true,
      "percentage": 65
    }
  }
});

var pie = new d3pie("pie_families", {
  "header": {
    "title": {
      "text": "Family targets",
      "fontSize": 32,
      "font": "open sans"
    },
    "subtitle": {
      "text": " ",
      "color": "#999999",
      "fontSize": 12,
      "font": "open sans"
    },
    "titleSubtitlePadding": 25
  },
  "footer": {
    "text": "Approved and distinct drugs",
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "center"
  },
  "size": {
    "canvasHeight": 600,
    "canvasWidth": 1100,
    "pieInnerRadius": "50%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "sortOrder": "value-asc",
    "smallSegmentGrouping": {
      "enabled": true,
      "value": 0.5
    },
    "content": {{drugfamilies|safe}}
  },
  "labels": {
    "outer": {
      "pieDistance": 21
    },
    "inner": {
      "hideWhenLessThanPercentage": 3
    },
    "mainLabel": {
      "fontSize": 12
    },
    "percentage": {
      "color": "#ffffff",
      "fontSize": 12
    },
    "value": {
      "color": "#adadad",
      "fontSize": 12
    },
    "lines": {
      "enabled": true,
      "style": "straight"
    },
    "truncation": {
      "enabled": true
    }
  },
  "tooltips": {
    "enabled": true,
    "type": "placeholder",
    "string": "{label}: {value}, {percentage}%",
    "styles": {
      "fadeInSpeed": 0,
      "backgroundOpacity": 0.71,
      "borderRadius": 10,
      "fontSize": 15
    }
  },
  "effects": {
    "load": {
      "speed": 800
    },
    "pullOutSegmentOnClick": {
      "effect": "linear",
      "speed": 400,
      "size": 14
    }
  },
  "misc": {
    "gradient": {
      "enabled": true,
      "percentage": 65
    }
  }
});

var pie = new d3pie("pie_disease", {
  "header": {
    "title": {
      "text": "Disease indications",
      "fontSize": 32,
      "font": "open sans"
    },
    "subtitle": {
      "text": " ",
      "color": "#999999",
      "fontSize": 12,
      "font": "open sans"
    },
    "titleSubtitlePadding": 25
  },
  "footer": {
    "text": "Approved and distinct drugs",
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "center"
  },
  "size": {
    "canvasHeight": 600,
    "canvasWidth": 1100,
    "pieInnerRadius": "50%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "sortOrder": "value-asc",
    "smallSegmentGrouping": {
      "enabled": true,
      "value": 1
    },
    "content": {{drugindications|safe}}
  },
  "labels": {
    "outer": {
      "pieDistance": 21
    },
    "inner": {
      "hideWhenLessThanPercentage": 3
    },
    "mainLabel": {
      "fontSize": 12
    },
    "percentage": {
      "color": "#ffffff",
      "fontSize": 12
    },
    "value": {
      "color": "#adadad",
      "fontSize": 12
    },
    "lines": {
      "enabled": true,
      "style": "straight"
    },
    "truncation": {
      "enabled": true
    }
  },
  "tooltips": {
    "enabled": true,
    "type": "placeholder",
    "string": "{label}: {value}, {percentage}%",
    "styles": {
      "fadeInSpeed": 0,
      "backgroundOpacity": 0.71,
      "borderRadius": 10,
      "fontSize": 15
    }
  },
  "effects": {
    "load": {
      "speed": 800
    },
    "pullOutSegmentOnClick": {
      "effect": "linear",
      "speed": 400,
      "size": 14
    }
  },
  "misc": {
    "gradient": {
      "enabled": true,
      "percentage": 65
    }
  }
});

var pie = new d3pie("pie_targets", {
  "header": {
    "title": {
      "text": "Receptor targets",
      "fontSize": 32,
      "font": "open sans"
    },
    "subtitle": {
      "text": " ",
      "color": "#999999",
      "fontSize": 12,
      "font": "open sans"
    },
    "titleSubtitlePadding": 25
  },
  "footer": {
    "text": "Approved and distinct drugs",
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "center"
  },
  "size": {
    "canvasHeight": 600,
    "canvasWidth": 1100,
    "pieInnerRadius": "50%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "sortOrder": "value-asc",
    "smallSegmentGrouping": {
      "enabled": true,
      "value": 1
    },
    "content": {{drugtargets|safe}}
  },
  "labels": {
    "outer": {
      "pieDistance": 21
    },
    "inner": {
      "hideWhenLessThanPercentage": 3
    },
    "mainLabel": {
      "fontSize": 12
    },
    "percentage": {
      "color": "#ffffff",
      "fontSize": 12
    },
    "value": {
      "color": "#adadad",
      "fontSize": 12
    },
    "lines": {
      "enabled": true,
      "style": "straight"
    },
    "truncation": {
      "enabled": true
    }
  },
  "tooltips": {
    "enabled": true,
    "type": "placeholder",
    "string": "{label}: {value}, {percentage}%",
    "styles": {
      "fadeInSpeed": 0,
      "backgroundOpacity": 0.71,
      "borderRadius": 10,
      "fontSize": 15
    }
  },
  "effects": {
    "load": {
      "speed": 800
    },
    "pullOutSegmentOnClick": {
      "effect": "linear",
      "speed": 400,
      "size": 14
    }
  },
  "misc": {
    "gradient": {
      "enabled": true,
      "percentage": 65
    }
  }
});
</script>
{% endblock %}