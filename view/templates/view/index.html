<head>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
    </script>
    <script>document.domain=document.domain;</script>
{% extends "home/base.html" %} 
{% load staticfiles %} 
{% block addon_css %}
<style>
.falselist{
    margin-bottom:4px;
    padding-left:15px;
}

.nav-tabs > li.active > a{
    background-color:#F3F3F3 !important; 
}
.gpcrbold{
    font-weight: bold;
}

.dropbtn {
    border: none;
    background-color: #00d215;
    width:16px; 
    height: 16px;
    cursor: pointer;
    padding:0;
}

.dropdown {
    cursor: pointer;
    /*margin-top:7px;
    margin-left:3px;*/

}

.dropdown-content {
	width:100%;
    display: none;
    position: absolute;
    z-index: 1;
}

.scrolldowndiv{
    overflow-y:auto;
    max-height:300px;
    overflow:auto;
}

/*.dropdown:hover .dropdown-content {
    display: block;
}*/

#content{
    width:100%;
}

</style>
{% endblock %}
</head>
<body>

{% block content %} 
{% csrf_token %}

 <!-- description  -->
 <div class="col-md-12" id="page_info">

     <div class="col-md-12 panel panel-primary" style="background-color:blue;text-align:center;color:white;margin-bottom:10px">   
         <div class="panel-body">
        	<h3 >GPCR viewer</h3>
         </div> 
     </div>

     <!-- main description -->
     
     
     <div class="col-md-12 panel panel-primary" style="margin-bottom:10px">
         <div id="show_hide_info" class="section_pan"  data-target="#more_info" data-toggle="collapse" style="cursor:pointer"><span id="show_hide_info_text" style="margin-left:5px;font-size:12px">Show info </span><span class="glyphicon glyphicon-chevron-down arrow"></span></div> 
     </div>

     
     <div class="col-md-12 panel panel-primary collapse" id="more_info">
         <div class="panel-body">

            <div style="text-align:center"> 
             <!--<h4 >GPCR VIEWER</h4>-->
            </div>
             <p style="text-align: justify;">Indicate what you want to display in your molecular representation using the selection options.</p>

         <p style="text-align: justify;">You can choose one of the selections we propose or define a new one using the <a href="http://nglviewer.org/ngl/api/manual/usage/selection-language.html" target="_blank">NGL selection language</a> to limit which atoms/residues are shown.<p>
        {% if gpcr_pdb != "no" %}
            <p style="text-align: justify;">Protein residues can be indicated as  <a href="http://docs.gpcrdb.org/generic_numbering.html" target="_blank" >generic GPCR residue numbers</a> (Ballesteros-Weinstein or GPCRdb structure-based numbering).</p>
        {% endif %}
<!--        <p style="text-align: justify;">If you wish to use more complex visualization options, you can open your structure in <a href="http://arose.github.io/mdsrv/" target="_blank" >MDsrv</a>.</p>-->
        <p style="text-align: justify;">Visualization technology powered by <a href="http://nglviewer.org/ngl/api/index.html" target="_blank" >NGL Viewer</a> and <a href="http://nglviewer.org/mdsrv/" target="_blank" >MDsrv</a>.</p>
             <p style="text-align: justify;margin-bottom:4px;font-weight:bold;color:#337AB7">Mouse controls:</p>
	    <span><p class="falselist">Left button hold and move: rotate camera around center.</p>
	    <p class="falselist">Left button click: pick atom or distance.</p>
	    <p class="falselist">Middle button hold and move: zoom camera in and out.</p>
	    <p class="falselist">Middle button click: center camera on atom.</p>
	    <p style="padding-left:15px" >Right button hold and move: translate camera in screen plane.</p></span>
            <!-- <p style="text-align: justify;">For more information about the viewer, visit the <a href="http://proteinformatics.charite.de/ngl/doc/index.html" target="_blank">NGL documentation</a>.</p>-->
         <p>For more information, see the <a href="{% url 'view:viewer_docs' %}" target="_blank" >docs</a>.
         </p>

         </div>
     </div>

</div> <!-- End page_info-->


<div id="pprotform"class="col-md-6 "> 
  <div id="protform" class="col-md-12 panel panel-primary leftPannel"> 
    <div class="panel-body" style="padding-top:10px">

<!-- 			<div style="text-align:center">
             			<h4><br>GPCR visualizaion</h4>
            		</div><br>   -->

        <div class="container-fluid" id="main_container">

        <div style="text-align:center;margin:5px 0 0 0;">
            <div class="row" id="VisualizationDiv" style="background-color:#F3F3F3; border-radius:2px;padding:5px;">
                <h4 style="padding:0;margin:0;">Visualization
                </h4>
            </div>
        </div>

        {% if all_prot_names %}
        <div style="margin:5px 0 5px 0;">
            <div class="row" style="padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;">
                {{all_prot_names}}
            </div>
        </div>
        {% endif %}


<!-- ============= IFRAME =========== -->
            <div id="view_screen" class="row str_file" data-struc_file={{structure_file}} data-struc_file_id={{structure_file_id}} data-dyn_id={{dyn_id}} data-all_chains="{{all_chains}}" data-delta="{{delta}}">
                <div class="row" style=max-width:620px;margin:auto>
                    <div id="legend" style="float:left;min-height:20px"> </div>
                    <!--button class="btn btn-danger btn-xs pull-right" style="margin:0;" type="button" id="clear_dist_reps">Clear distances</button>-->
                </div>  
                <div >
                    <div style="margin:auto;position:relative;overflow-y:hidden;overflow-x:auto;height:445px;max-width:622px;border: 1px solid #F5F5F5;margin-bottom:5px">
                    
                         {% if traj_list %}
                          <div class="dropdown" style="position:absolute;z-index:10">
                            <button id="selectedTraj" class="btn btn-info btn-xs dropdown-toggle" type="button" data-toggle="dropdown" style="margin-left:3px;margin-top:7px" data-tpath={{traj_list.0.0}} data-fplot_file={{traj_list.0.3}} >{{ traj_list.0.1 }}
                            <span class="caret"></span></button>
                            <ul class="dropdown-menu" style="height: auto;max-height:350px;overflow-x: hidden;padding:0">
                              <li class="traj_element tsel" style="padding:5px 10px 5px 10px;background-color:#FFF7F7" id="traj_id_{{traj_list.0.2}}" data-tpath={{traj_list.0.0}} data-fplot_file={{traj_list.0.3}} >{{traj_list.0.1}}</li>
                            {% for traj in traj_list|slice:"1:" %}
                              <li class="traj_element" style="padding:5px 10px 5px 10px;" id="traj_id_{{traj.2}}" data-tpath={{traj.0}} data-fplot_file={{traj.3}} >{{traj.1}}</li>
                            {% endfor %}
                            </ul>
                          </div>
                         {% endif %}
                        <iframe style="border:none;position:absolute;top:-30px;" id="embed_mdsrv" data-mdsrv_url={{mdsrv_url}} src="{{mdsrv_url}}/html/embed.html" scrolling="no" height="1000px" width="620px"></iframe>
                    </div>

                </div>          
            </div>            
           

<!-- ============= Apply buttonss =========== -->
            <div style="margin-bottom:5px">
                <div class="row" style="margin-top:5px;margin-bottom:10px;" >
                     <div style="padding-right:3px;padding-left:3px">
                     <p style='text-align:right;color:#808080'>Visualization and trajectory sharing powered by <a href="http://nglviewer.org/ngl/api/index.html" rel="noreferrer" target="_blank">NGL viewer</a> and <a href="http://nglviewer.org/mdsrv/" rel="noreferrer" target="_blank">MDSrv</a></p>
                    </div>
                 </div>
                 <div class="row" style="margin-top:5px;margin-bottom:10px;" >
                   <div style="padding-right:3px;padding-left:3px"> 
                      <!--<button  class="btn btn-success" id="submit" >Apply</button> -->
                      <button  class="btn btn-danger btn-xs" id="clearAll" style="margin-top:5px">Clear All</button>
                      <div class="pull-right">
                          <!--
                          <button id="center" class="btn btn-default" type="button" style="padding-right:7px;padding-left:7px;height:35px" >Center</button>
                          <div class="btn-group">
                            <button type="button" id="bckg_dark" class="btn btn-default bckg_theme" style="padding-left:5px;padding-right:5px">Dark</button>
                            <button type="button" id="bckg_light" class="btn btn-default bckg_theme active" style="padding-left:5px;padding-right:5px">Light</button>
                          </div>                      
                          <button class="btn btn-default" type="button" id="screenshot"  style="font-size:12px;padding-right:7px;padding-left:7px;height:35px" ><span class="glyphicon glyphicon-camera" style="margin-right:5px"></span>Screenshot</button>
                          -->
                                
                          
                          
                          <button id="restartPos" type="button" class="btn btn-link settingsB" title="Reset position" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-repeat"></span></button>       
                          <button id="center" type="button" class="btn btn-link settingsB" title="Center" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-record"></span></button>
                          <button id="background" type="button" class="btn btn-link settingsB light" title="Dark background" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-adjust"></span></button>
                          <button id="screenshot" type="button" class="btn btn-link settingsB" title="Take screenshot" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-camera"></span></button>                                    
                        <!--  <a id="to_mdsrv" class="settingsB" href="{{mdsrv_url}}/html/mdsrv_emb.html" target="_blank" style="padding:7px;color:#585858" title="Advanced visualization"><span class="glyphicon glyphicon-cog"></span></a>-->
                        <a id="to_mdsrv" class="btn btn-link settingsB" href="{{mdsrv_url}}/html/mdsrv_emb.html" target="_blank" style="padding:7px;color:#585858" title="Advanced visualization"><span class="glyphicon glyphicon-cog"></span></a>
                        
                          <div  id="moreSettings_div" class="dropdown displaydrop pull-right" >
                            <button id="moreSettings" type="button" class="btn btn-link settingsB dropbtn_opt" title="More setting options" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-plus-sign"></span></button>
                            <div class="dropdown-content" style="padding: 7px; background-color: white; width: 252px; display: block; border: 1px solid #808080; border-radius:2px;display:none">
                                  

                                    <div style="margin-bottom:10px;">
                                        Show H atoms 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="showHOn" class="btn btn-default showHSet" style="padding:2px 5px 2px 5px;">On</button>
                                          <button type="button" id="showHOff" class="btn btn-default active showHSet" style="padding:2px 5px 2px 5px;">Off</button>
                                        </div> 
                                    </div>                                  
                                    <div style="margin-bottom:10px;">
                                        Projection 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="projOrtho" class="btn btn-default projectionOP" style="padding:2px 5px 2px 5px;width:85px">Orthographic</button>
                                          <button type="button" id="projPersp" class="btn btn-default active projectionOP" style="padding:2px 5px 2px 5px;width:85px">Perspective</button>
                                        </div> 
                                    </div>
                                    <div style="margin-bottom:10px;">
                                        Spin 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="spinOn" class="btn btn-default spinSet" style="padding:2px 5px 2px 5px;">On</button>
                                          <button type="button" id="spinOff" class="btn btn-default active spinSet" style="padding:2px 5px 2px 5px;">Off</button>
                                        </div> 
                                    </div>
                                    <div style="margin-bottom:10px;">
                                        Trajectory step size: <input class="form-control input-sm rvSpaces" id="trajStep"  type="number" placeholder=3 style="width:50px;padding-left:7px;padding-right:2px;">
                                    </div>
                                    <div >
                                        Trajectory timeout: <input class="form-control input-sm rvSpaces" id="trajTimeOut"  type="number" placeholder=50 style="width:50px;padding-left:7px;padding-right:2px;"> ms
                                    </div>
                                    


                                  
                            </div>
                          </div>
   
                      </div>
                   </div>
     	        </div>
             </div>
             
             
        <div style="text-align:center;margin:0;">
            <div class="row" id="selectionDiv" style="background-color:#F3F3F3; border-radius:2px;padding:5px;">
                <h4 style="padding:0;margin:0;">Selection
                </h4>
            </div>
        </div>
        <div id ="allSelTools" style="margin-bottom:30px">
<!-- ============= Comp buttonss =========== -->
        <div id="quicksel_all" style="margin-bottom:5px">
            <div class="row" style="margin-top:10px;">
                <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#quicksel"><span>Quick selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
            </div>
            <div id="quicksel" class="collapse" style="padding-right:15px;">


                <div class="row" style="margin-top:10px;margin-bottom:10px"><center>
                    <button title="{{chains}}" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default receptor active nglCallBtn"  id="receptor">Receptor</button>
                    {% if other_prots%}
                      <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements nonGPCR nglCallBtn" title="{{other_prots.1}}" id="{{other_prots.0}}" >Other proteins</button>
                    {% endif %}
                    {% for long_n, short_n in compounds %}
                      <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements comp nglCallBtn" title="{{short_n}}" id="{{short_n}}" >{{long_n}}</button>
                    {% endfor %}
                    {% if ligands_short %}
                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements" title="GPCR residues within 2.5 Angstrom of ligand" id="bindingSite" data-ligli="{{ligands_short}}" >Binding site</button>
                    {% endif %}
                    {% if compounds|length > 1%}
                    <button  class="btn btn-default nglCallBtn" id="btn_all" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;background-color:#f2f2f2;padding:5px">All</button>
                    <button  class="btn btn-default nglCallBtn" id="btn_clear" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;background-color:#fde8ec;border-color:#fbd0d8;padding:5px">Clear</button>
                    {% endif %}
                </center></div>
                
              	<center>
                  <div style="height:1px;background-color:lightgrey;width:90%"></div>
                </center>
                
               <div class="row" style="margin-top:15px">
               
                <div class="sel_within" style="padding-left:5px;margin-right:5px;margin-left:0;margin-bottom:10px;">
                  <div class="dist_sel" id="row0" style="margin-bottom:5px">
                    <span class="tick" ></span>
                    <span class="always" style="margin-left:14px">
                     Show 
                        <select class="resWthComp nglCallChangeWth" name="rescomp">
                            <option  selected value="protein">residues</option> <!-- This can be improved by considering the case of multiple proteins: add option for each prot at this sel.-->
                           {% for long_n, short_n in compounds %}
                                <option   value="{{short_n}}">{{long_n}}</option>
                           {% endfor %}
                        </select>                     
                      within 
                    <input class="form-control input-sm inputdist nglCallChangeWth" type="text" style="width:40px;padding-left:7px;">
                      &#8491; of
                        <select class="wthComp" name="comp">
                           {% for long_n, short_n in compounds %}
                           <option   value="{{short_n}}">{{long_n}}</option>
                           {% endfor %}
                           {% if other_prots%}
                           <option   value="{{other_prots.0}}">Other proteins</option>
                           {% endif %}
                           <option   value="user_sel">Selection</option>
                        </select>
                        <span class="user_sel_input_p"></span>
                        <button class="btn btn-link rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;" ><span class="glyphicon glyphicon-remove-sign"></span></button>
                        <button class="btn btn-link add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-plus-sign"></span></button>
                    </span>
                    <div class="alert_sel_wth"></div>
                  </div>
                  <!--<span id="show_within"></span>-->
                </div>
                
               </div>
               <!--<div style="margin-left:18px">
                   <div class="row">
                     <input class="updateSelOrNot" type="radio" checked value="updateTrue" name="updateSelOrNot"> 
                      Update selection at each frame
                   </div>
                   <div class="row">
                     <input class="updateSelOrNot" type="radio" value="updateFalse" name="updateSelOrNot"> 
                      Restrict selection at frame 
                        <input type="number" style="width:50px;padding-left:7px;padding-right:2px;"  id="distSelFr" class="form-control input-sm rvSpaces">
                      of trajectory
                            <select id="" name="distSel_traj">
                               {% for traj in traj_list %}
                               <option class="distSel_traj" name="{{traj.0}}" value="{{traj.2}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>
                      
                   </div>
               </div>-->
               
            </div>
        </div>
<!-- ============= Input selection =========== -->
            <div id="selection_all" style="margin-bottom:5px;margin-top:5px">
            <div class="row">
                <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#selection"><span>Atom selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
            </div>
            <div id="selection" class="collapse" style="padding-right:15px;">


             <div class="gpcr_pdb" style="padding-left:15px" data-gpcr_pdb ="{{gpcr_pdb}}" >
               <div id="text_input_all"  style="margin-top:10px;">
                    <div  class="text_input" id="ti_row0" style="margin-bottom:5px">
                       <div  class="row">
                          <div class="col-sm-11 ti_left" style="padding-right:3px;padding-left:3px"> 
	                        <input type="text" value="" class="form-control sel_input nglCallChange" placeholder="Specify your selection" style="width:100%;background-color:#F8F8F8">
	                        <div class="pull-right" style="padding:0;margin:0;font-size:12px">
	                             <div style="float:left;height:27px" >
                                    <select class="high_type nglCallChangeTI" name="high_type0" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                       <option value="licorice">Licorice</option>
                                       <option value="ball+stick">Ball+stick</option>
                                       <option value="hyperball">Hyperball</option>
                                       <option value="line">Line</option>
                                       <option value="spacefill">Spacefill</option>
                                       <option value="cartoon">Cartoon</option>
                                       <option value="ribbon">Ribbon</option>
                                       <option value="rope">Rope</option>
                                       <option value="tube">Tube</option>
                                       <!--<option value="axes">Axes</option>-->
                                    </select>
                                    <select class="high_scheme nglCallChangeTI" name="high_scheme0" style="padding:0;font-size:12px;width:90px;height:24px;margin: 3px 0 0 0">
                                       <option value="element">Element</option>
                                       <option value="uniform">Uniform</option>
                                       <option value="chainid">Chain</option>
                                       <option value="moleculetype">Molecule type</option>
                                       <option value="sstruc">Structure</option>
                                       <option value="resname">Residue name</option>
                                       <option value="residueindex">Residue index</option>
                                       <option value="hydrophobicity">Hydrophobicity</option>
                                       {% if seg_li %}
                                       <option value="FPscheme">GPCR Helices</option>
                                       {% endif %}
                                    </select>
                                  </div>
                                  <div class="dropdown displaydrop" style="float:left;height:27px;margin:3px 0 0 0;padding:0">
                                    <button class="dropbtn" style="margin-top: 7px; margin-left: 3px;" data-color="#00d215"></button> 
                                    <div class="dropdown-content" style="margin-left:3px">
                                          <div class="dropcolor nglCallClickTI" style="background-color:#3193ff;width:16px; height: 16px;" data-color="#3193ff"></div>
                                          <div class="dropcolor nglCallClickTI" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
      									  <div class="dropcolor nglCallClickTI" style="background-color:#ff4c00;width:16px; height: 16px;" data-color="#ff4c00"></div>
      									  <div class="dropcolor nglCallClickTI" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
      									  <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors nglCallClickTI" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                    </div>
                                  </div>
                                  <span class="span_morecolors displaydrop" style="float:left" ></span><!--   <input type="text" style="width:50px;padding-left:3px;padding-right:3px;height:22px;margin-top:2px;margin-bottom:0;font-size:12px" placeholder="#FFFFFF" class="form-control input-sm input_dd_color">
 -->
	                       </div>
                          </div>
                          <div class="col-sm-1 radio" style="padding-right:0;padding-left:0;margin-top:7px;width:48px;text-align: center">
                                <button class="btn btn-link ti_rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;"><span class="glyphicon glyphicon-remove-sign"></span></button>
                                <button class="btn btn-link ti_add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0"><span class="glyphicon glyphicon-plus-sign"></span></button>
                          </div>
                      </div>
                      <div class="ti_alert"> </div>      
                  </div>
              </div>

             </div>
            </div>
            </div>
<!-- ============= Sequence selection =========== -->
{% if prot_seq_pos %}
            <div id="seqselection_all" style="margin-bottom:5px;margin-top:5px">
            <div class="row">
                <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#seqselection"><span>Sequence selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
            </div>
            <div id="seqselection" class="collapse" style="padding-right:15px;">


             <div  style="padding-left:15px;margin-top:10px;" >
             
               <div id="seq_input_all"  style="display:none">
                    <div  class="seq_input_row" id="si_row0" style="margin-bottom:5px">
                       <div  class="row">
                          <div class="col-sm-11 si_left" style="padding-right:3px;padding-left:3px"> 
	                        <input type="text" value="" class="form-control seq_input nglCallChange" placeholder="Specify your selection" style="width:100%;background-color:#F8F8F8">
	                        <div class="pull-right" style="padding:0;margin:0;font-size:12px">
	                             <div style="float:left;height:27px" >
                                    <select class="high_type nglCallChangeTI" name="high_type0" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                       <option value="licorice">Licorice</option>
                                       <option value="ball+stick">Ball+stick</option>
                                       <option value="hyperball">Hyperball</option>
                                       <option value="line">Line</option>
                                       <option value="spacefill">Spacefill</option>
                                       <option value="cartoon">Cartoon</option>
                                       <option value="ribbon">Ribbon</option>
                                       <option value="rope">Rope</option>
                                       <option value="tube">Tube</option>
                                       <!--<option value="axes">Axes</option>-->
                                    </select>
                                    <select class="high_scheme nglCallChangeTI" name="high_scheme0" style="padding:0;font-size:12px;width:90px;height:24px;margin: 3px 0 0 0">
                                       <option value="element">Element</option>
                                       <option value="uniform">Uniform</option>
                                       <option value="chainid">Chain</option>
                                       <option value="moleculetype">Molecule type</option>
                                       <option value="sstruc">Structure</option>
                                       <option value="resname">Residue name</option>
                                       <option value="residueindex">Residue index</option>
                                       <option value="hydrophobicity">Hydrophobicity</option>
                                       {% if seg_li %}
                                       <option value="FPscheme">GPCR Helices</option>
                                       {% endif %}
                                    </select>
                                  </div>
                                  <div class="dropdown displaydrop" style="float:left;height:27px;margin:3px 0 0 0;padding:0">
                                    <button class="dropbtn" style="margin-top: 7px; margin-left: 3px;" data-color="#00d215" ></button> 
                                    <div class="dropdown-content" style="margin-left:3px">
                                          <div class="dropcolor nglCallClickTI" style="background-color:#3193ff;width:16px; height: 16px;" data-color="#3193ff"></div>
                                          <div class="dropcolor nglCallClickTI" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
      									  <div class="dropcolor nglCallClickTI" style="background-color:#ff4c00;width:16px; height: 16px;" data-color="#ff4c00"></div>
      									  <div class="dropcolor nglCallClickTI" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
      									  <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors nglCallClickTI" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                    </div>
                                  </div>
                                  <span class="span_morecolors displaydrop" style="float:left" ></span><!--   <input type="text" style="width:50px;padding-left:3px;padding-right:3px;height:22px;margin-top:2px;margin-bottom:0;font-size:12px" placeholder="#FFFFFF" class="form-control input-sm input_dd_color">
 -->
	                       </div>
                          </div>
                          <div class="col-sm-1 radio" style="padding-right:0;padding-left:0;margin-top:7px;width:48px;text-align: center">
                                <button class="btn btn-link si_rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;"><span class="glyphicon glyphicon-remove-sign"></span></button>
                                <button class="btn btn-link si_add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0"><span class="glyphicon glyphicon-plus-sign"></span></button>
                          </div>
                      </div>
                      <div class="si_alert"> </div>      
                  </div>
              </div>

              
              <div style="margin-bottom:20px" class="row">

              <div id="seq_sel_div" style="padding:5px;border:1px solid #F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                <!--<button  class="btn btn-link" id="addToSel" type="button" style="padding:0 0 0 10px;display:none"><span id="addToSelHov" class="glyphicon glyphicon-ok" style="color:#5CB85C"> Confirm selection</button>-->
                <button style="display:none" type="button" id="addToSel" class="btn btn-success btn-xs"><span style="font-size: 10px;" class="glyphicon glyphicon-ok" ></span> Confirm selection</button>
              
                <div class="row" style="margin:10px;width:auto;height:250px;overflow:auto;">
                  {% for prot_name, seq_pos in prot_seq_pos %}
                    <div style="clear: left;padding-bottom:20px">
                      {% if prot_seq_pos|length > 1 %}
                         <div>{{prot_name}}</div>
                      {% endif %}
                      {% for seq,pos,gnum,chain,index in seq_pos %}
                      <div id="{{index}}" title="{{gnum}}" class="seq_sel" style="cursor:pointer;float: left;text-align:center;font-size:10px;margin-bottom:5px;background-color:#f2f2f2">
                        <div id="ss_seq" style="clear: left;border:1px solid #E8E8E8; ;width:25px;height:15px">{{seq}}</div>
                        <div id="ss_pos" class="{{chain}}" style="clear: left;border:1px solid #E8E8E8 ;width:25px;height:15px">{{pos}}</div>
                      </div>            
                      {% endfor %}
                    </div>
                  {% endfor %}
                </div> 
              </div>
              </div>
              
              
             </div>
            </div>
            </div>

       {% endif %}
<!-- ============= Predefined views of cons pos =========== -->
           {% if gpcr_pdb != "no" %}
            <div id="cons_pos_box_all" data-gpcr_id_name="{{gpcr_id_name_js}}" style="margin-top:5px;margin-bottom:5px">
            <div class="row">
                <div class="section_pan" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#cons_pos_box"><span>GPCR conserved positions </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div>               
                <!--<button style="background-color:#ffffff;text-align:left;border-bottom:2px solid blue;border-radius:0"  type="button" class="btn btn-block" data-toggle="collapse" data-target="#cons_pos_box">GPCR conserved positions</button>-->
            </div>
            <div id="cons_pos_box" class="collapse" style="padding-right:15px;padding-left:15px;padding-top:10">
              {% if gpcr_id_name|length > 1 %}
                <div class="row" style="margin-bottom:10px">
                      <select class="form-control" style="width:100%;height:32px;" id="gpcr_sel">
                        <option value="all">All GPCRs</option>
                        {% for gpcr_id, prot_name in gpcr_id_name.items %}
                        <option value="{{gpcr_id}}">{{prot_name}}</option>
                        {% endfor %}
                      </select>
                </div>
                <!-- Conserved pos for all GPCRs -->
                    <div id="gpcr_id_all" class="gpcr_prot_show_cons" style="display:inline">
                        <ul class="nav nav-tabs" id="allclasses">
                          <li class="GPCRclass {{cons_pos_all_info.2.A.0}} cons_nav" data-TF="{{cons_pos_all_info.1.A}}"><a data-TF="{{cons_pos_all_info.1.A}}" class="cons_nav" data-toggle="tab" href="#classA_all">Class A</a></li>
                          <li class="GPCRclass {{cons_pos_all_info.2.B.0}} cons_nav" data-TF="{{cons_pos_all_info.1.B}}"><a data-TF="{{cons_pos_all_info.1.B}}" class="cons_nav" data-toggle="tab" href="#classB_all">Class B</a></li>
                          <li class="GPCRclass {{cons_pos_all_info.2.C.0}} cons_nav" data-TF="{{cons_pos_all_info.1.C}}"><a data-TF="{{cons_pos_all_info.1.C}}" class="cons_nav" data-toggle="tab" href="#classC_all">Class C</a></li>
                          <li class="GPCRclass {{cons_pos_all_info.2.F.0}} cons_nav" data-TF="{{cons_pos_all_info.1..F}}"><a data-TF="{{cons_pos_all_info.1..F}}" class="cons_nav" data-toggle="tab" href="#classF_all">Class F</a></li>
                        </ul>
                        <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                            <div style="margin:0;" id="classA_all" class="tab-pane {{cons_pos_all_info.2.A.1}}">
                                {% if cons_pos_all_info.1.A %}
                                    {% if cons_pos_all_info.0.A.1 %}
                                        <p>Highly conserved residues and motifs</p>
	                                        {% for pos in cons_pos_all_info.0.A.1 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
	                                        {% for pos in motifs_all_info.A %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                    {% if cons_pos_all_info.0.A.0 %}
                                        <p>Most conserved residues</p>
	                                        {% for pos in cons_pos_all_info.0.A.0 %}
                                           <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div id="classB_all" class="tab-pane {{cons_pos_all_info.2.B.1}}">
                                  {% if cons_pos_all_info.0.B.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_pos_all_info.0.B.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                    {% endfor %}   
                                  {% endif %}                         
                            </div>  
                            <div id="classC_all" class="tab-pane {{cons_pos_all_info.2.C.1}}">
                                  {% if cons_pos_all_info.0.C.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_pos_all_info.0.C.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>  
                            <div id="classF_all" class="tab-pane {{cons_pos_all_info.2.F.1}}">
                                  {% if cons_pos_all_info.0.F.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_pos_all_info.0.F.0 %}
                                  <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>
                            <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear all</button>
                       </div>
                    </div>
                <!-- Conserved pos for each of the GPCRs -->
                {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                    <div id="gpcr_id_{{gpcr_id}}" class="gpcr_prot_show_cons" style="display:none">
                        <ul class="nav nav-tabs" id="allclasses">
                          <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#classA_{{gpcr_id}}">Class A</a></li>
                          <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#classB_{{gpcr_id}}">Class B</a></li>
                          <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#classC_{{gpcr_id}}">Class C</a></li>
                          <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#classF_{{gpcr_id}}">Class F</a></li>
                        </ul>
                        <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                            <div style="margin:0;" id="classA_{{gpcr_id}}" class="tab-pane {{active_class.A.1}}">
                                {% if show_class.A %}
                                    {% if cons_class.A.1 %}
                                        <p>Highly conserved residues and motifs</p>
	                                        {% for pos in cons_class.A.1 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
	                                        {% for pos in motifs_def.A %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                    {% if cons_class.A.0 %}
                                        <p>Most conserved residues</p>
	                                        {% for pos in cons_class.A.0 %}
                                           <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div id="classB_{{gpcr_id}}" class="tab-pane {{active_class.B.1}}">
                                  {% if cons_class.B.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.B.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                    {% endfor %}   
                                  {% endif %}                         
                            </div>  
                            <div id="classC_{{gpcr_id}}" class="tab-pane {{active_class.C.1}}">
                                  {% if cons_class.C.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.C.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>  
                            <div id="classF_{{gpcr_id}}" class="tab-pane {{active_class.F.1}}">
                                  {% if cons_class.F.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.F.0 %}
                                  <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>
                            <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear all</button>
                       </div>
                    </div>
               {% endfor %}
               {% else %} <!-- When only 1 gpcr: -->
                   {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                    <div id="gpcr_id_{{gpcr_id}}" class="gpcr_prot_show_cons">
                        <ul class="nav nav-tabs" id="allclasses">
                          <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#classA"> Class A</a></li>
                          <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#classB">Class B</a></li>
                          <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#classC">Class C</a></li>
                          <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#classF">Class F</a></li>
                        </ul>
                        <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                            <div style="margin:0;" id="classA" class="tab-pane {{active_class.A.1}}">
                                {% if show_class.A %}
                                    {% if cons_class.A.1 %}
                                        <p>Highly conserved residues and motifs</p>
	                                        {% for pos in cons_class.A.1 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
	                                        {% for pos in motifs_def.A %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                    {% if cons_class.A.0 %}
                                        <p>Most conserved residues</p>
	                                        {% for pos in cons_class.A.0 %}
                                           <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div id="classB" class="tab-pane {{active_class.B.1}}">
                                  {% if cons_class.B.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.B.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                    {% endfor %}   
                                  {% endif %}                         
                            </div>  
                            <div id="classC" class="tab-pane {{active_class.C.1}}">
                                  {% if cons_class.C.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.C.0 %}
                                    <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>  
                            <div id="classF" class="tab-pane {{active_class.F.1}}">
                                  {% if cons_class.F.0 %}
                                    <p>Most conserved residues</p>
                                    {% for pos in cons_class.F.0 %}
                                  <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                   {% endfor %}
                                  {% endif %}
                            </div>
                            <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear all</button>
                       </div>
                    </div>
                   {% endfor %}
               {% endif %}
            </div>
            </div>
            {% endif %}

<!-- ============= Trajectories =========== --> 
 <!--         {% if traj_list %}
           <div id="trajectories_all" style="margin-top:5px;margin-bottom:5px">
              <div class="row">
                 <div class="section_pan" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0" data-toggle="collapse" data-target="#emb_trajectories"><span>Trajectories </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
              </div>
              <div id="emb_trajectories" class="collapse" >
                  <div class="checkbox" >
			  <span style="margin-right:10px"><label><input  type="checkbox" name="traj" class="traj_element" id="traj_id_{{traj_list.0.2}}" value="{{traj_list.0.0}}" checked>{{traj_list.0.1}}</label></span>
			{% for traj in traj_list|slice:"1:" %}
			  <span style="margin-right:10px"><label><input  type="checkbox" name="traj" class="traj_element" id="traj_id_{{traj.2}}" value="{{traj.0}}">{{traj.1}}</label></span>
			{% endfor %}
		  </div>
              </div>
          </div>
          {% endif %}-->
        </div><!-- End allSelTools -->

          
    </div> <!-- Panel-body -->          
   </div>
          
          <!--<input type="checkbox" name="nglCall" value="nglCallSign">-->
        </div>
         
    </div> <!-- left half -->

     <div class="col-md-6" id="right_half">
        <div class="col-md-12 panel panel-primary" >
            <div class="panel-body" style="padding-top:10px">
                <div class="container-fluid" id="main_analysis_container">        
<!-- ANALYSIS -->                
                
<!-- ============= Analysis =========== --> 
           {% if traj_list %}  
        <div style="text-align:center;margin:0;padding:5px;">
            <div class="row" style="background-color:#F3F3F3; border-radius:2px;">
                <h4 id="analysisDiv" style="padding:0;margin:0;padding:5px;">Analysis
                </h4>
            </div>
        </div>
           <div id="all_analysis" style="margin-bottom:30px">   
<!-- ======================================== -->
        {% if fpdir %}
           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_fplot" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Flare Plots </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-up arrow"></span></div>
           </div>
           <div id="analysis_fplot" class="collapse in" >
                <div id="fpdiv" data-fpdir="{{fpdir}}" data-fpseg_li="{{seg_li}}" style="margin-top:10px;overflow:auto">

    <!-- 
                   <div class="row" style="margin-top:10px;margin-bottom:15px" >
                       <div style="margin-left:18px;margin-bottom:10px;color:#808080">
                            Represent a dynamic interaction network of <span style="font-weight:bold">hydrogen bonds</span> in the GPCR.
                        </div>
                        <div id="fpinfo" style="margin-left:18px;margin-bottom:10px;" >
                         Trajectory: 
                                <select id="fplot_traj" name="fplot_traj">
                                   {% for fp in fplot_path %}
                                       <option   value="{{fp.1}}">{{fp.2}}</option>
                                   {% endfor %}
                                </select>

                         </div>
                   </div>
     -->

    <!-- Link to big FP with slide  -->
     <!--           {% if seg_li %}    
                    <div class="row"> 
                            <a id="gotofplot" href="{% url 'view:fplot_gpcr' dyn_id=dyn_id filename=traj_list.0.3 seg_li=seg_li %}" target="_blank" class="pull-right btn btn-info" role="button" style="padding:5px;margin-left:10px;margin-right:15px;margin-top:5px" >Accept</a>
                    </div>
                    {% endif %}-->
                    
               <center>
                 <div id="flare-container"></div>

                  <button id="FPdisplay" class="btn btn-info active showIfTrajFP" type="button" style="margin-top:10px;font-size:12px;width:115px;padding-right:2px;padding-left:2px;">
                    Hide interactions
                  </button>
               
                  <button class="summarizeFP showIfTrajFP btn btn-info" type="button" style="margin-top:10px;width:115px;font-size:12px;">
                    Summarize
                  </button>
                  <button id="FPclearSel" class="showIfTrajFP btn btn-danger" type="button" style="margin-top:10px;width:115px;font-size:12px;">
                    Clear selections
                  </button>
               </center>
               <div class="showIfTrajFPBlock" style="margin-bottom:10px;margin-top:10px;color:#808080;">
                    <a href="https://github.com/GPCRviz/flareplot" target="_blank" >Flare Plots</a> powered by R. Fonseca and A. J. Venkatakrishnan.
                </div>
               </div><!-- End fpdiv -->
           </div> 
        {% endif %}
<!-- ======================================== -->
<!-- ============= Compute distances =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_dist" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Distance </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
            </div>
             <div id="analysis_dist" class="collapse row">
             <div style="margin-top:10px;margin-left:5px">
                <div style="margin-right:5px;margin-left:14px;margin-bottom:15px;color:#808080">
                    Select distances from the viewer by clicking on the atoms. Afterwards, import your selections by clicking at the import button. You can also manually introduce the atom indices.
                </div>
                <div class="dist_btw" style="margin-right:5px;margin-left:0;">
                  <div class="dist_pair" id="row2_0" style="margin-bottom:5px">
                    <span class="tick2" ></span>
                    <span class="always2" style="margin-left:14px">
                     Compute distance between 
                     
                     <select class="dist_el_sel">
                        <option class="dist_el_opt" name="dist_el" value="atoms" selected >atoms</option>
                        <option class="dist_el_opt" name="dist_el" value="residues">residues</option>
                     </select>
                     
                     <span class="dist_from_parent">
                        <input class="form-control input-sm dist_from" type="text" title="Introduce atom index" style="width:50px;padding-left:7px;margin-bottom:5px">
                    </span>
                     <span class="dist_from_res_parent dis_res_bth_parent" style="display:none">
                        <input class="form-control input-sm dist_from_res dis_res_bth" type="text" title="Introduce residue number and chain name (ex. 50:P)" placeholder="xx:C" style="width:50px;padding-left:7px;margin-bottom:5px;">
                    </span>
                    <span class="dist_from_atomNm_parent"></span>
			        and
                     <span class="dist_to_parent">
                         <input class="form-control input-sm dist_to" type="text" title="Introduce atom index" style="width:50px;padding-left:7px;margin-bottom:5px">
                     </span>
                     <span class="dist_to_res_parent dis_res_bth_parent" style="display:none">
                        <input class="form-control input-sm dist_to_res dis_res_bth" type="text" placeholder="xx:C" title="Introduce residue number and chain name (ex. 50:P)" style="width:50px;padding-left:7px;margin-bottom:5px;">
                    </span>
                     <span class="dist_to_atomNm_parent"></span>
                     <button class="btn btn-link del_btn2" style="color:#DC143C;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-remove-sign"></span></button>  
                     <button class="btn btn-link only1st add_btn2" style="color:#57C857;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-plus-sign"></span></button>
                     <button title="Import distances from the structure." class="btn btn-link only1st imp_btn2" style="color:#1e90ff;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-circle-arrow-down"></span></button>
                     <!--<button id="rm_btn2"  class="btn btn-link" style="color:#DC143C;font-size:20px;margin:0;padding:0;visibility:hidden" ><span class="glyphicon glyphicon-minus-sign"></span></button> -->

                    </span>
                  </div>

                  <!--<span id="show_dist"></span>                  -->
                </div>
                
                {% if traj_list %}
                <div style="margin-left:17px;">
                    <div style="margin-bottom:10px;">
                     In trajectory: 
                       <span style="margin-left:5px">
                            <select id="" name="dist_traj">
                               <!--<option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option class="trajForDist" name="{{traj.0}}" value="{{traj.2}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>
                       </span>
                    </div>
                    <div id="dist_stride_parent">
                        Stride: <input class="form-control input-sm inp_stride" id="dist_stride"  type="number" placeholder=1 style="width:50px;padding-left:7px;">
                    </div>
                    <div class=row>
                        <button id="gotoDistPg" class="pull-right btn btn-info withTrajs" style="margin-top:5px;padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                </div>
                {% else %}
                <button id="gotoDistPg" class="btn btn-info withoutTrajs" style="padding:5px;margin-left:14px;margin-right:15px" >Compute</button>
                {% endif %}
                <div class="row" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" id="dist_alert"> </div>
                <div id="dist_chart" style="margin-bottom:15px"></div>
              <!-- <center><div style="margin-right:40px;overflow:auto;overflow-y:hidden;-ms-overflow-y: hidden;" >{{ chart.as_html }}</div></center>-->
               </div>
               </div>
<!-- ============= RMSD Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_rmsd" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>RMSD </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_rmsd" class="collapse">
             <div class="row" style="margin-top:10px;margin-bottom:15px">

                    <div style="margin-left:18px;margin-bottom:10px;">
                     Trajectory: 
                            <select id="rmsd_traj" name="rmsd_traj">
                               <!--option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>

                    </div>
                    <div class="col-md-12"  style="margin-left:18px;margin-bottom:10px;padding:0"> 
                       <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                       </div>
                       <div id="rmsd_sel_frames_id" class="col-md-10" >
                          <div class="row">
                             <input type="radio" name="rmsd_sel_frames" value="all_frames" checked> 
                                  All
                          </div>
                          <div class="row" style="margin-bottom:5px">
                             <input type="radio" name="rmsd_sel_frames" value="rmsd_frames_mine"> 
                                 From 
                                 <span class="rmsd_from_parent">
                                   <input class="form-control input-sm maxinp8 changeVal" id="rmsd_frame_1" type="text" style="width:50px;padding-left:7px;">
                                 </span>
                                 to 
                                 <span class="rmsd_to_parent">
                                   <input class="form-control input-sm maxinp8 changeVal" id="rmsd_frame_2" type="text" style="width:50px;padding-left:7px;">
                                 </span>
                          </div>
                          <div style="margin-bottom:5px" id="rmsd_stride_parent" class="row">
                            Stride: <input class="form-control input-sm inp_stride" id="rmsd_stride" type="number" placeholder=1 style="width:50px;padding-left:7px;">
                          </div>

                          <div id="rmsd_sel_frames_error" class="row" >
                          </div>
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-left:18px;margin-bottom:10px;padding:0"> 
                        Reference: frame 
                            <input placeholder=0 class="form-control input-sm maxinp8 changeVal" id="rmsd_ref_frame" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                            from trajectory 
                            <select id="rmsd_ref_traj_id" name="rmsd_ref_traj">
                               <!--<option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>
                          <div class="col-md-12" id="rmsd_ref_frames_error" class="row" style="padding:0" >
                          </div>
                    </div>
                    <div id="rmsd_sel_id" style="margin-left:18px;margin-bottom:20px"> 
                       <div style="margin-bottom:10px;padding:0"  class="col-md-12">
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Selection:
                           </div>
                           <div class="col-md-10" >
                              <div  class="row">
                                 <input type="radio" name="rmsd_sel" value="bck" checked> Protein alpha carbons
                              </div>
                              <div  class="row">
                                 <input type="radio" name="rmsd_sel" value="min"> Protein CA, CB, C, N, O
                              </div>
                              <div class="row">
                                 <input type="radio" name="rmsd_sel" value="noh"> Non-hydrogen protein atoms
                              </div>
                              <div class="row">
                                 <input type="radio" name="rmsd_sel" value="all_prot"> All protein atoms
                              </div>
                              {% for long_n, short_n in ligands %}
                                  <div class="row">
                                     <input type="radio" name="rmsd_sel" value="{{short_n}}"> {{long_n}}
                                  </div>
                              {% endfor %}
                              <!--<div class="row">
                                 <input type="radio" name="rmsd_sel" value="all_atoms"> All atoms
                              </div>-->
                           </div>
                        </div>
                   </div>
                    <div class=row>
                      <button id="gotoRMSDPg" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                    <div class="row" style="margin-left:14px;margin-top:5px;padding-right:15px;clear:left;" id="rmsd_alert"> </div>
                  <div class="col-md-12;clear:left;" id="rmsd_chart" ></div>
                </div>
              </div>



<!-- ============= Interaction Analysis =========== --> 
            {% if ligands|length >= 1 %}
            
           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_Int" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Interaction </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_Int" class="collapse">
             <div class="row" style="margin-top:10px;">
              
                    <div class="int_btw" style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                         Compute interaction between GPCR and 
                            <select id="comp_int" name="comp_int">
                               <!--<option class="ligInt"  value="allLig">All ligands</option>-->
                               {% for long_n, short_n in ligands %}
                               <option class="ligInt unitInt"  value="{{short_n}}">{{long_n}}</option>
                               {% endfor %}
                             <!--  {% if other_prots%}
                               <option   value="{{other_prots.0}}">Other proteins</option>
                               {% endif %}-->
                            </select>  
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                         In trajectory: 
                           <span style="margin-left:5px">
                                <select id="" name="int_traj">
                                   <!--<option disabled selected value> </option>-->
                                   {% for traj in traj_list %}
                                   <option class="trajForInt" name="{{traj.0}}" value="{{traj.2}}">{{traj.1}}</option>
                                   {% endfor %}
                                </select>
                           </span>
                           <span style="color:#DC143C;margin-left:5px" id="int_traj_error"></span>
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px" id="int_stride_parent">
                        Stride: <input class="form-control input-sm inp_stride" id="int_stride"  type="number" placeholder=1 style="width:50px;padding-left:7px;">
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                        Threshold:
                          <input class="form-control input-sm " id="int_thr" type="number" title="Residues are considered to interact with the ligand when the distance beween any of the considered atoms is smaller than the threshold." style="width:50px;padding-left:7px;" value=3 placeholder=3> &#8491; 
                          <span style="color:#DC143C;margin-left:5px" id="int_thr_error"></span>
                    </div>
                    <div style="margin-right:5px;margin-left:14px;">
                         Consider 
                            <select id="dist_scheme" >
                               <option class="dist_scheme_opt"  value="closest-heavy">heavy atoms only</option>
                               <option class="dist_scheme_opt"  value="closest">all atoms</option>
                            </select>  
                    </div>
                    <div class="row">
                            <button id="gotoInt" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px;margin-top:5px" >Compute</button>
                    </div>
                    <div class="row" style="margin-top:5px;padding-right:15px;margin-left:14px" id="int_alert"> </div>
                    <div style="margin-top:5px;"  id="int_info" ></div>
                    <!--<div class="checkbox" style="margin-left:14px;margin-bottom:15px">
		                <label><input type="checkbox" name="view_int" checked >Display interacting residues</label>
                   </div>-->
              </div>
              </div>
            {% endif %}
           <!-- </div> original -->
<!-- ============= BONDS Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_bonds" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Hbonds</span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_bonds" class="collapse">
                 <div class="row" style="margin-top:10px;margin-bottom:15px">


                        <div style="margin-left:18px;margin-bottom:10px;">
                         Trajectory: 
                                <select id="hbonds_traj" name="hbonds_traj">
                                   {% for traj in traj_list %}
                                   <option   value="{{traj.0}}">{{traj.1}}</option>
                                   {% endfor %}
                                </select>

                        </div>
                        <div class="col-md-12"  style="margin-left:18px;margin-bottom:10px;padding:0"> 
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                           </div>
                           <div id="bonds_sel_frames_id" class="col-md-10" style="margin-bottom:5px" >
                              <div class="row">
                                 <input type="radio" name="bonds_sel_frames" value="all_frames" checked> 
                                      All
                              </div>
                              <div class="row" >
                                 <input type="radio" name="bonds_sel_frames" value="bonds_frames_mine"> 
                                     From 
                                     <span id="bonds_frame_1_par">
                                         <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="bonds_frame_1" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                     </span>
                                     to 
                                     <span id="bonds_frame_2_par">
                                         <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="bonds_frame_2" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                     </span>

                              </div>
                              <div id="hbonds_sel_frames_error" class="row" >
                              </div>
                        </div>
                        
                        
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Selection:
                           </div>
                           <div id="bonds_backbone" class="col-md-10" style="margin-bottom:10px">
                                 <div class="row">
		                              <input type="checkbox" name="neighbours" checked > Do not include Hbonds between neighbours
                                  </div>

                                  <div class="row">
                                     <input type="radio" name="backbone" value="all" checked> 
                                          All Hydrogen Bonds
                                  </div>
                                  <div class="row" >
                                     <input type="radio" name="backbone" value="sidechain"> 
                                          Only Side Chain Hydrogen Bonds
                                  </div>


                              <div class="row">
                                 <input type="radio" name="backbone" value="all" checked> 
                                       Include backbone Hydrogen Bonds
                              </div>
                           </div>
                        <div>
                            <span id="hbonds_cutoff_par">
                                Threshold: <input class="form-control input-sm changeThresh maxinp8 rvSpaces" placeholder=10 id="hbonds_cutoff" type="number" style="width:60px;padding-left:7px;margin-bottom:5px" title="Hydrogen bonds with a frequency lower than the threshold will be filtered out."> %
                            </span>
                        </div>
                 </div>


                <div class=row>
                  <button id="ComputeHbonds" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                </div>
                <div id="bonds_alert" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" class="row"> </div>
                 <div class="col-md-12" id="bondsresult_par" style="margin-top:10px;margin-bottom:15px;display:none;">

                        <div id="bondsresult" style="margin-bottom:20px"> 
                           <div style="margin-bottom:10px;padding:0"  class="col-md-12">

                               <div class='scrolldowndiv' id="hbonds" style="margin-bottom:10px;padding:0"  class="col-md-6"></div> 
                              <center>
                                <button id="ShowAllHbIntra" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;margin-bottom:20px;display:none;" >Show All</button>
                                <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showhb">Clear all</button>
                               </center>


                               <div class='scrolldowndiv' id="hbondsnp" style="margin-bottom:10px;padding:0"  class="col-md-6"></div>
                               <center>
                                    <button id="ShowAllHbInter" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;display:none;" >Show All</button>
                                    <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showhb_inter">Clear all</button>
                                </center>
                                                         
                            
                           </div>
                        </div>

                    </div>
                  </div>
            </div>

<!-- ============= SaltBridges Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_salt" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Salt Bridges</span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_salt" class="collapse">
             <div class="row" style="margin-top:10px;">

                    <div style="margin-left:18px;margin-bottom:5px;">
                     Trajectory: 
                            <select id="salt_traj" name="salt_traj">
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>

                    </div>
                    <div class="col-md-12"  style="margin-left:18px;margin-bottom:15x;padding:0"> 
                       <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                       </div>
                       <div id="salt_sel_frames_id" class="col-md-10" >
                          <div class="row">
                             <input type="radio" name="salt_sel_frames" value="all_frames" checked> 
                                  All
                          </div>
                          <div class="row" >
                             <input type="radio" name="salt_sel_frames" value="salt_frames_mine"> 
                                 From 
                                 <span id="salt_frame_1_par">
                                     <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="salt_frame_1" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>
                                 to 
                                 <span id="salt_frame_2_par">
                                    <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="salt_frame_2" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>

                          </div>
                          <div id="salt_sel_frames_error" class="row" ></div>
                        </div>
                    </div>
             </div>

            <div class="row" style="margin-top:5px;margin-bottom:15px;margin-left:3px">
                Threshold: <input class="form-control input-sm changeThresh maxinp8 rvSpaces" id="salt_cutoff" type="number" placeholder=10 title="Salt bridges with a frequency lower than the threshold will be filtered out." style="width:60px;padding-left:7px;margin-bottom:5px"> %
            </div>

             <div class="row" style="margin-top:10px;margin-bottom:15px">
                    <div class=row>
                      <button id="ComputeSaltBridges" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                    <div id="salt_alert" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" class="row"> </div>
                    <div id="saltresult_par" style="display:none" class="col-md-12" >
                        <div id="saltresult" style="margin-bottom:20px"> 
                           <div style="margin-bottom:10px;padding:0"  class="col-md-12" >

                           <div class='scrolldowndiv' id="saltbridges" style="margin-bottom:10px;padding:0"></div>

                            <center>
                                <button id="ShowAllSb" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;display:none;" >Show All</button>
                                <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showsb">Clear all</button>
                            </center>
                      
                           </div>
                        </div>
                      </div>

                </div>
              </div>

<!-- ============= SASA Analysis =========== --> 

<!--           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_grid" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>SASA analysis</span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_grid" class="collapse">
             <div class="row" style="margin-top:10px;margin-bottom:15px">

                    <div style="margin-left:18px;margin-bottom:10px;">
                     Trajectory: 
                            <select id="grid_traj" name="grid_traj">
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">{{traj.1}}</option>
                               {% endfor %}
                            </select>

                    </div>
                    <div class="col-md-12"  style="margin-left:18px;margin-bottom:10px;padding:0"> 
                       <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                       </div>
                       <div id="grid_sel_frames_id" class="col-md-10" id="sasa_selection">
                          <div class="row">
                             <input type="radio" name="grid_sel_frames" value="all_frames" checked> 
                                  All
                          </div>
                          <div class="row" >
                             <input type="radio" name="grid_sel_frames" value="grid_frames_mine"> 
                                 From 
                                 <span id="grid_frame_1_par">
                                    <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="grid_frame_1" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>
                                 to 
                                 <span id="grid_frame_2_par">
                                    <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="grid_frame_2" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>
                                 
                               <div id="grid_sel_frames_error" ></div>

                          </div>


                           <div class="col-md-10" id="sasa_atoms" >
                              <div  class="row">
                                 <input type="radio" name="sasa_sel" value="all" checked> All atoms
                              </div>
                              <div id='show_seq_sel'  class="row">
                                 <input type="radio" name="sasa_sel" value="sequence"> Sequence Selection
                              </div>
                              <div  class="row">
                                 <input type="radio" name="sasa_sel" value="receptor"> Receptor
                              </div>
                              <div  class="row">
                                 <input type="radio" name="sasa_sel" value="half"> Lower half of receptor
                              </div>
                              <div  class="row">
                                 <input type="radio" name="sasa_sel" value="up_half"> Upper half of receptor
                              </div>
                              <div  class="row">
                                 <input type="radio" name="sasa_sel" value="up"> Extracellular receptor
                              </div>
                              <div class="row">
                                 <input type="radio" name="sasa_sel" value="bottom"> Intracelular receptor
                              </div>
                            </div>

                        </div>
                    </div>
             </div>

            <div class=row>
              <button id="ComputeGrid" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
            </div>
            <div id="sasa_alert" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" class="row"> </div>
            
            
             <div class="row" id="sasa_par" style="margin-top:10px;margin-bottom:15px">
                    <div id="sasa_container">
                    </div>

            </div>
          </div> --><!-- End of SASA analysis --->

            </div><!-- End of ALL analysis --->

            {% endif %}
                
<!-- ANALYSIS END -->        
                </div>
            </div>
        </div>
     </div>

{% endblock content %} 
         

{% block addon_js %} 
       <script src="{% static 'view/emb_ngl_viewer.js' %}"></script>
 <!-- Flare plots -->
        <link rel="stylesheet" type="text/css" href="{% static 'view/fplot2/docs/css/flareplot-main.css' %}" />
        <script src="{% static 'view/fplot2/d3.v3.min.js' %}"></script>
        <script src="{% static 'view/fplot2/docs/js/flareplot-main.js' %}"></script><!-- D:< -->
       
 <!-- End Flare plots -->
{% endblock %}


</body>
