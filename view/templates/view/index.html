<head>
<style>
.falselist{
    margin-bottom:4px;
    padding-left:15px
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script>
$(document).ready(function(){
    function encode (sth) {return encodeURIComponent(sth).replace(/%20/g,'+');}
    var struc = $(".str_name").text();
    var ligName = encode($("#iframe_lig").attr("title"));
    var url_orig = "http://localhost:8081/html/embed/embed.html?struc="+encode(struc) + "&ligN=" + ligName;
    var rep = ["r"];
    var sel = "";
    var sel_enc = encode(sel);
    $("#to_mdsrv").click(function(){ //Obtain the list of selected trajs and open them when MDsrv button is clicked.
         var traj = [];
         $(".traj_element:checked").each(function(){
             traj.push($(this).attr("value"))
         });
         $(this).attr("href", "http://localhost:8081/html/mdsrv_emb.html?struc=" + encode(struc) + "&ligN=" + ligName  + "&traj=" + encode(traj) +  "&rep=" + rep + "&sel=" + sel_enc);//
    });
    $("iframe").attr("src", url_orig + "&rep=" +rep + "&sel=" + sel_enc);
    $("#sel_input").val("");
//    var rep_orig = "#iframe_" + rep;
//    $(rep_orig).addClass("active");
    $("#iframe_r").addClass("active");

    $("#sel_input").change(function(){
        sel = $(this).val();
        sel_enc = encode(sel);
        url = url_orig + ("&rep=" + rep +"&sel=" + sel_enc);
        $("iframe").attr("src", url);
    });
    function clickRep (id, newRep, clicked) {
        if ( clicked == 1 ) {
            var index = $.inArray(newRep,rep);
            if (index == -1) {
                rep.push(newRep);
            }
            url = url_orig + ("&sel=" + sel_enc + "&rep=" + encode(rep));
            $("iframe").attr("src", url);
            $(id).addClass("active");
            return  2;
        } else {
            var index = $.inArray(newRep,rep);
            if (index > -1) {
                rep.splice(index, 1);
            }
            url = url_orig + ("&sel=" + sel_enc + "&rep=" + encode(rep));
            $("iframe").attr("src", url);
            $(id).removeClass("active");
            return  1;
        }
    }

    var clicked_r = 1, clicked_w = 1, clicked_lip = 1, clicked_i = 1, clicked_lig = 1;
    $("#iframe_r").click(function(){
        clicked_r = clickRep("#iframe_r","r", clicked_r);
    });

    $("#iframe_w").click(function(){
        clicked_w = clickRep("#iframe_w","w", clicked_w);
    });

    $("#iframe_lip").click(function(){
        clicked_lip = clickRep("#iframe_lip","lip", clicked_lip);
    });

    $("#iframe_i").click(function(){
        clicked_i =clickRep("#iframe_i","i", clicked_i);
    });

    $("#iframe_lig").click(function(){
        clicked_lig = clickRep("#iframe_lig","lig", clicked_lig);
    });

    $("#iframe_all").click(function(){
        rep = ["r","w","lip","i","lig"];
        url = url_orig + ("&sel=" + sel_enc + "&rep=" + encode(rep));
        $("iframe").attr("src", url);
        $("#iframe_r , #iframe_w , #iframe_lip , #iframe_i , #iframe_lig").addClass("active");
        clicked_r = clicked_lip = clicked_w = clicked_i = clicked_lig = 2;
    });

    $("#iframe_clear").click(function(){
        rep = ["r"];
        url = url_orig + ("&sel=" + sel_enc + "&rep=" + encode(rep));
        $("iframe").attr("src", url);
        $("#iframe_r").addClass("active");
        $("#iframe_w , #iframe_lip , #iframe_i , #iframe_lig").removeClass("active");
        clicked_r = clicked_lip = clicked_w = clicked_i = clicked_lig = 2;
    });
});

</script>


</head>
{% extends "home/base.html" %} 
{% load staticfiles %} 


{% block content %} 
{% csrf_token %}

 <!-- description column -->
 <div class="col-md-4">

     <div class="col-md-12 panel panel-primary" style="background-color:blue;text-align:center;color:white;">   
         <div class="panel-body">
        	<h3 >Title?</h3>
         </div> 
     </div>

     <!-- main description -->
     <div class="col-md-12 panel panel-primary">
         <div class="panel-body">

            <div style="text-align:center"> 
             <h4 >GPCR VIEWER</h4>
	    </div>
             <p style="text-align: justify;">Please select what you want to display in your molecular representation.</p>

	     <p style="text-align: justify;">You can choose one of the selections we propose or define a new one using the <a href="http://proteinformatics.charite.de/ngl/doc/index.html#User_manual/Usage/Selection_language" target="_blank">NGL selection language</a> to limit which atoms/residues are shown.<p>
             <p style="text-align: justify;margin-bottom:4px">Mouse controls:</p>
		<span><p class="falselist">Left button hold and move: rotate camera around center.</p>
		<p class="falselist">Middle button hold and move: zoom camera in and out.</p>
		<p class="falselist">Middle button click: center camera on atom.</p>
		<p style="padding-left:15px" >Right button hold and move: translate camera in screen plane.</p></span>
             <p style="text-align: justify;">For more information about the viewer, visit the <a href="http://proteinformatics.charite.de/ngl/doc/index.html" target="_blank">NGL documentation</a>.</p>
             <p style="text-align: justify;">If you wish a more complete visualization or to add a trajectory, you can open your structure in <a href="http://arose.github.io/mdsrv/" target="_blank" >MDsrv</a>.</p>

         </div>
     </div>

     <!-- link to docs -->
     <div class="col-md-12 panel panel-primary">
         <div class="panel-body">
             <p>For more information on this form, see the <a href="http://docs.gpcrdb.org/receptors.html">docs</a>.
             </p>
         </div>
     </div>
  </div>
 <!--   <body> -->

<div id="pprotform"class="col-md-7 "> 
  <div id="protform" class="col-md-12 panel panel-primary"> 
    <div class="panel-body">

<!-- 			<div style="text-align:center">
             			<h4><br>GPCR visualizaion</h4>
            		</div><br>   -->

        <div class="container-fluid" style="padding-top:15px">
            <div class=row><p class=str_name>{{structure}}</p></div>
<!-- --------------------- 

            <div class="row" >
                <center>
                  <button  style="width:90px" class="btn btn-default" id="iframe_r" >Receptor</button>
                  <button style="width:90px" class="btn btn-default" id="iframe_w">Water</button>
                  <button style="width:90px" class="btn btn-default" id="iframe_lip">Lipids</button>
                  <button style="width:90px" class="btn btn-default" id="iframe_i">Ions</button>
                  <button style="width:90px" title="{{ ligandname }}" class="btn btn-default" id="iframe_lig">Ligand</button>
                  <button style="width:90px" class="btn btn-default" id="iframe_all" style="background-color:#f2f2f2">All</button>
                </center>
            </div>
            <div class="row" >
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_clear" style="background-color:#fde8ec">Clear</button>
               </div>
            </div>
-->
            <div class="row" >
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px" > 
                  <button  class="btn btn-block btn-default" id="iframe_r" >Receptor</button>
               </div>
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_w">Water</button>
               </div>
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_lip">Lipids</button>
               </div>
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_i">Ions</button>
               </div>
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button title="{{ ligandname }}" class="btn btn-block btn-default" id="iframe_lig">Ligand</button>
               </div>
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_all" style="background-color:#f2f2f2">All</button>
               </div>
            </div>
            <div class="row" >
               <div class="col-sm-2" style="padding-bottom:10px;padding-right:3px;padding-left:3px">  
                  <button  class="btn btn-block btn-default" id="iframe_clear" style="background-color:#fde8ec">Clear</button>
               </div>
            </div>

            <div class="row">
               <div  style="padding-bottom:10px;padding-right:3px;padding-left:3px" > 
	             <input class="form-control" type="text" id="sel_input" placeholder="Specify your selection" style="width:100%;background-color:#F8F8F8">
                </div>
            </div>

            <div>
               <iframe src="http://localhost:8081/html/embed/embed.html" style="width:100%;height:370px;border:none;overflow:hidden" scrolling="no"></iframe>  
            </div>

          </div>

   </div>
        <div class="container-fluid" style="padding:0;margin-top:10px;">
            <div class="panel panel-default" >
                <div class="panel-body" style="padding-top:0">
<!--                  <p style="color:#337ac1;">Open in MDsrv</p>-->
		    <div class="checkbox" >
			{% for traj in traj_list %}
			  <span style="margin-right:10px"><label><input  type="checkbox" name="traj" class="traj_element" value="{{traj}}">{{traj}}</label></span>
			{% endfor %}
		    </div>
                    <a class="btn btn-default"  id="to_mdsrv" role="button"  href="http://localhost:8081/html/mdsrv_emb.html">Open in MDsrv</a>

                </div>
            </div>
        </div>



{% endblock content %} 
         

{% block addon_js %} 


{% endblock %}



